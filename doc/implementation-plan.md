# BigScreen Pro 功能实现计划

> 基于 Grafana 核心功能分析

---

## 阶段一：模板变量系统 (P0) ✅

### 1.1 变量管理器
- [x] 创建 `src/stores/variable.ts` 变量 Store
- [x] 实现变量 CRUD 操作
- [x] 实现变量解析和替换逻辑

### 1.2 变量组件
- [x] 创建 `src/components/Variable/` 变量选择器组件
- [x] 支持下拉单选、多选、正则过滤
- [x] 支持数据类型：查询、自定义、文本、常量

### 1.3 变量解析
- [x] 实现 `$variable` 语法解析
- [x] 实现 `${variable:format}` 格式转换
- [x] 实现多值变量拼接

### 1.4 单元测试
- [x] 变量 Store 测试 (25 cases)
- [x] 变量解析器测试 (46 cases)
- [x] 组件测试 (通过 E2E 验证)

---

## 阶段二：Panel 配置增强 (P1) ✅

### 2.1 配置面板优化
- [x] 统一配置面板 UI (4标签页: 基础/数据/样式/高级)
- [x] 添加数据源选择器
- [x] 添加刷新间隔配置
- [x] 添加样式配置(主题/背景/字体/边框/阴影/动画)
- [x] 添加高级配置(交互/事件/工具提示)

### 2.2 更多图表类型
- [x] Trend Chart 趋势图
- [x] Canvas 自由布局
- [x] Geomap 地理地图 (已存在 MapChart)
- [x] Node Graph 关系图增强 (已存在 GraphChart)
- [x] ComponentLibrary 更新: 新增10+图表类型

### 2.3 单元测试
- [x] 现有测试保持通过 (241 tests)

---

## 阶段三：实时数据推送 (P2)

### 3.1 WebSocket 服务
- [ ] 创建 `src/services/websocket.ts`
- [ ] 实现连接管理
- [ ] 实现心跳检测
- [ ] 实现断线重连

### 3.2 实时数据组件
- [ ] 创建实时数据 Hook
- [ ] 实现数据流处理
- [ ] 实现增量更新

### 3.3 单元测试
- [ ] WebSocket 服务测试 (25+ cases)
- [ ] 实时 Hook 测试 (15+ cases)

---

## 阶段四：多数据源支持 (P2)

### 4.1 数据源插件架构
- [ ] 创建 `src/services/dataSource/` 目录
- [ ] 定义数据源接口
- [ ] 实现数据源管理器

### 4.2 内置数据源
- [ ] REST API 数据源
- [ ] MySQL/PostgreSQL 数据源
- [ ] CSV/JSON 文件数据源

### 4.3 单元测试
- [ ] 数据源管理器测试 (20+ cases)
- [ ] 各数据源测试 (30+ cases)

---

## 阶段五：告警系统 (P3)

### 5.1 告警规则管理
- [ ] 创建告警 Store
- [ ] 实现告警规则 CRUD
- [ ] 实现阈值条件判断

### 5.2 通知渠道
- [ ] 邮件通知
- [ ] Webhook 通知

### 5.3 单元测试
- [ ] 告警规则测试 (20+ cases)
- [ ] 通知测试 (10+ cases)

---

## 阶段六：权限系统 (P3)

### 6.1 RBAC 权限
- [ ] 权限 Store
- [ ] 角色管理 (Admin/Editor/Viewer)
- [ ] 资源权限控制

### 6.2 单元测试
- [ ] 权限测试 (20+ cases)

---

## 阶段七：仪表盘模板 (P3)

### 7.1 模板系统
- [ ] 模板 Store
- [ ] 预设模板库
- [ ] 模板导入/导出

### 7.2 单元测试
- [ ] 模板测试 (15+ cases)

---

## 测试覆盖率目标

| 阶段 | 目标覆盖率 |
|------|-----------|
| 阶段一 | 85%+ |
| 阶段二 | 80%+ |
| 阶段三 | 85%+ |
| 阶段四 | 80%+ |
| 阶段五 | 75%+ |
| 阶段六 | 75%+ |
| 阶段七 | 80%+ |
| **总计** | **80%+** |

---

## UI 设计参考

### Grafana 风格特点
1. 深色主题为主
2. 简洁的图标
3. 统一的圆角和间距
4. 清晰的层次结构
5. 渐变色强调重点

### 实现策略
- 复用现有 Element Plus 组件
- 自定义主题变量
- 添加动画过渡效果
